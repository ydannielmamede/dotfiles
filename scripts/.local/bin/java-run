#!/bin/bash

# 1. Detecta a raiz do projeto usando o Git
PROJECT_ROOT=$(git rev-parse --show-toplevel 2>/dev/null)

if [ -z "$PROJECT_ROOT" ]; then
    PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
fi

cd "$PROJECT_ROOT"

# 2. Configurações de pastas
BIN_DIR="./bin"
SRC_DIR="./src"
LIB_DIR="./lib"

# 3. Limpeza e preparação (COM QUEBRA DE LINHA REAL)
mkdir -p "$BIN_DIR"
rm -rf "$BIN_DIR"/*

# 4. Compilação Recursiva
find "$SRC_DIR" -name "*.java" > sources.txt
javac -d "$BIN_DIR" -cp "$LIB_DIR/*:$SRC_DIR" @sources.txt
rm sources.txt

# 5. Execução
if [ $? -eq 0 ]; then
    # Se o App tiver 'package', lembre de usar 'pacote.App'
    java -cp "$BIN_DIR:$LIB_DIR/*" App
else
    echo "!!! Erro de Compilação !!!"
    exit 1
fi
